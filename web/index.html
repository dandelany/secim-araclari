<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="styles.css">
    <link type="text/css" rel="stylesheet" href="lib/scatter-matrix.css">

    <script src="lib/underscore-min.js" charset="utf-8"></script>
</head>
<body>

<h2 style="font-size:24px;">
    Turkish Local Elections 2014
</h2>
<div class="scatter-container">

</div>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="lib/scatter-matrix.js"></script>
<script src="turkey.js"></script>
<script type="text/javascript">
//    var sm = new ScatterMatrix('../data/city_results/ADANA.csv');
//    sm.render();
//    var plot = new TScatterplot('../data/city_results/ADANA.csv');
//    plot.render();
// set the stage
var margin = {t:30, r:20, b:20, l:40 },
        w = 900 - margin.l - margin.r,
        h = 600 - margin.t - margin.b,
        x = d3.scale.linear().range([0, w]),
        y = d3.scale.linear().range([h - 60, 0]),
//colors that will reflect geographical regions
        color = d3.scale.category10();

var svg = d3.select(".scatter-container").append("svg")
        .attr("width", w + margin.l + margin.r)
        .attr("height", h + margin.t + margin.b);

// set axes, as well as details on their ticks
var xAxis = d3.svg.axis()
        .scale(x)
        .ticks(20)
        .tickSubdivide(true)
        .tickSize(6, 3, 0)
        .orient("bottom");

var yAxis = d3.svg.axis()
        .scale(y)
        .ticks(20)
        .tickSubdivide(true)
        .tickSize(6, 3, 0)
        .orient("left");

// group that will contain all of the plots
var groups = svg.append("g").attr("transform", "translate(" + margin.l + "," + margin.t + ")");

// array of the regions, used for the legend
var regions = ["Asia", "Europe", "Middle East", "N. America", "S. America", "Sub-Saharan Africa"]

var cities = ['ADANA', 'ADIYAMAN', 'AFYONKARAHİSAR', 'AĞRI', 'AKSARAY']
// bring in the data, and do everything that is data-driven
//AFYONKARAHİSAR
d3.json("../data/city_results/AKSARAY.json", function(data) {

    // sort data alphabetically by region, so that the colors match with legend
    //data.sort(function(a, b) { return d3.ascending(a.region, b.region); });
    console.log(data);
    window.citydata = data;

    //var x0 = Math.max(-d3.min(data, function(d) { return d.trust; }), d3.max(data, function(d) { return d.trust; }));
    x.domain([0, 1.3]);
    y.domain([0, 1]);

    // kayitli_secmen = registered voters
    // kullanilan_toplam_oy = total votes
    // akp_oy = AKP votes


    // style the circles, set their locations based on data
    var circles =
            groups.selectAll("circle")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "circles")
                    .attr({
                        //cx: function(d) { return x(d.kullanilan_toplam_oy / d.kayitli_secmen); },
                        //cx: function(d) { return x(d.oy_kullanan_kayitli_secmen / d.kayitli_secmen); },
                        //cx: function(d) { return x(d.gecersiz_oy / d.kayitli_secmen); },
                        cx: function(d) { return x(d.kullanilan_toplam_oy / d.kayitli_secmen); },
                        cy: function(d) { return y(d.akp_oy / d.kayitli_secmen); },
                        r: 2,
                        opacity: 0.5,
                        id: function(d) { return d.alan; }
                    })
                    .style("fill", '#aa0000');


    // tooltips (using jQuery plugin tipsy)
//    circles.append("title")
//            .text(function(d) { return d.country; })

//    $(".circles").tipsy({ gravity: 's', });

    // the legend color guide
    var legend = svg.selectAll("rect")
            .data(regions)
            .enter().append("rect")
            .attr({
                x: function(d, i) { return (40 + i*80); },
                y: h,
                width: 25,
                height: 12
            })
            .style("fill", function(d) { return color(d); });


    // legend labels
    svg.selectAll("text")
            .data(regions)
            .enter().append("text")
            .attr({
                x: function(d, i) { return (40 + i*80); },
                y: h + 24,
            })
            .text(function(d) { return d; });

    // draw axes and axis labels
    svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(" + margin.l + "," + (h - 60 + margin.t) + ")")
            .call(xAxis);

    svg.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate(" + margin.l + "," + margin.t + ")")
            .call(yAxis);

    svg.append("text")
            .attr("class", "x label")
            .attr("text-anchor", "end")
            .attr("x", w + 50)
            .attr("y", h - margin.t - 5)
            .text("voter turnout");

    svg.append("text")
            .attr("class", "y label")
            .attr("text-anchor", "end")
            .attr("x", -20)
            .attr("y", 45)
            .attr("dy", ".75em")
            .attr("transform", "rotate(-90)")
            .text("% vote for AKP");
    });
</script>
</body>
</html>
